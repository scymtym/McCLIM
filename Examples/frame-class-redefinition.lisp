;;; ---------------------------------------------------------------------------
;;;   License: BSD-2-Clause
;;; ---------------------------------------------------------------------------
;;;
;;;  (c) copyright 2019, 2020 Jan Moringen <jmoringe@techfak.uni-bielefeld.de>
;;;
;;; ---------------------------------------------------------------------------
;;;
;;; Demonstrates the definition of an application frame class that
;;; updates the panes, layouts, command tables, etc of its instances
;;; when the application frame class is redefined.

(defpackage #:clim-demo.frame-class-redefinition
  (:use
   #:clim-lisp
   #:clim)

  (:export
   #:frame-class-redefinition))

(in-package #:clim-demo.frame-class-redefinition)

(defvar *redefintion-description*
  (format nil "The class of this frame is defined in ~@
               ~@
               ~2@T~A.~@
               ~@

               Try changing and re-evaluating (for example using C-c ~@
               C-c in SLIME) the ~A form in that file.~@

               ~@
               Things to try:~@
               • Change pane definitions~@
               ~2@T• Change initargs (labels, background colors, etc.)~@
               ~2@T• Change pane types (for example :push-button to :toggle-button)~@
               ~2@T• Change the :scroll-bars and :borders initargs of the interactor pane~@
               • Add new pane definitions (and add them to one or more layouts)~@
               • Change layouts~@
               • Reorder layouts to change the primary (i.e. first) ~
                 layout in the layout list~@
               • Change the \"pretty name\" of the frame~@
               • Change the icon of the frame~@
               • Add or remove the :pointer-documentation and :menu-bar options"
          #.(or *compile-file-pathname* *load-pathname*)
          'define-application-frame))

(define-application-frame frame-class-redefinition ()
  ()
  (:panes
   (label         :label         :label        *redefintion-description*
                                 :background   +beige+)
   (push-button-1 :push-button   :label        "Button 1")
   (push-button-2 :push-button   :label        "Button 2"
                                 :foreground   +white+
                                 :background   +blue+)
   (slider        :slider        :min-value    0
                                 :max-value    10
                                 :value        1
                                 :show-value-p t
                                 :orientation  :horizontal)
   (toggle-button :toggle-button :label        "Toggle this")
   (interactor    :interactor    :scroll-bars t
                                 :borders     3))
  (:layouts
   (:default
    (spacing (:thickness 8 :background +dark-gray+)
      (vertically (:spacing 8)
        label
        (horizontally (:spacing 8)
          (2/3 slider)
          (1/3 toggle-button))
        (horizontally (:spacing 8)
          push-button-1
          push-button-2)
        (make-pane 'clime:box-adjuster-gadget)
        (:fill interactor))))
   (:second-layout
    label))
  (:menu-bar nil)
  (:update-instances-on-redefinition t)
  (:default-initargs
   :pretty-name "Redefine me!"
   :icon        #+(or) climi::*default-icon-large*
                #+(and)  climi::*default-icon-small*))

(defun frame-class-redefinition ()
  (run-frame-top-level (make-application-frame 'frame-class-redefinition)))
